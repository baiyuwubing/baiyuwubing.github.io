var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function a(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n["throw"](e))}catch(t){o(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(n){i=[6,n],o=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseView=function(e){function t(){var t=e.call(this)||this;return t._needBlackBg=!0,t._needShowEffect=!0,t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.percentWidth=this.percentHeight=100,this.drawBlackBg()},t.prototype.drawBlackBg=function(){if(this._needBlackBg){var e=2*this.stage.stageWidth,t=2*this.stage.stageHeight;this._bgShape||(this._bgShape=new egret.Shape,this._bgShape.graphics.beginFill(0,.5),this._bgShape.graphics.drawRect(0,0,e,t),this._bgShape.graphics.endFill()),this._bgShape.x=(this.width-e)/2,this._bgShape.y=(this.height-t)/2,this.addChildAt(this._bgShape,0)}else func.removeFromParent(this._bgShape)},t.prototype.isShow=function(){return this.visible},t.prototype.show=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.visible=!0;var i=this.parent||this._parent;i&&(i.addChild(this),egret.Tween.removeTweens(this),this._needShowEffect&&(this.alpha=.2,this.scaleX=this.scaleY=.9,egret.Tween.get(this).to({alpha:1}),egret.Tween.get(this).to({scaleX:1,scaleY:1},500,egret.Ease.backInOut)))},t.prototype.hide=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];egret.Tween.removeTweens(this),egret.Tween.get(this).to({alpha:0,scaleX:.8,scaleY:.8},500).call(function(){e.visible=!1,e._parent=e.parent,func.removeFromParent(e)})},t.prototype.addTouchTapEvent=function(e,t,i,n){e.addEventListener(egret.TouchEvent.TOUCH_TAP,t,this,i,n)},t.prototype.hideBgShape=function(){this._bgShape&&(this._bgShape.visible=!1)},t.prototype.showBgShape=function(){this._bgShape&&(this._bgShape.visible=!0)},t.prototype.setParent=function(e){this._parent=e},t}(eui.Component);__reflect(BaseView.prototype,"BaseView",["eui.UIComponent","egret.DisplayObject"]);var SingletonClass=function(){function e(){}return e.ins=function(){return this._ins||(this._ins=new this),this._ins},e}();__reflect(SingletonClass.prototype,"SingletonClass");var BaseP2Body=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,"position0",{get:function(){return this.position[0]},set:function(e){this.position[0]=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position1",{get:function(){return this.position[1]},set:function(e){this.position[1]=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.world&&this.world.removeBody(this);for(var e=0,t=this.displays||[];e<t.length;e++){var i=t[e];func.removeFromParent(i)}},t}(p2.Body);__reflect(BaseP2Body.prototype,"BaseP2Body");var LocalStorageMgr=function(e){function t(){var t=e.call(this)||this;return t._game_key="bricks_breakers",t}return __extends(t,e),t.ins=function(){return e.ins.call(this)},t.prototype.setLocal=function(e,t){egret.localStorage.setItem(this._game_key+e,t)},t.prototype.getLocal=function(e,t){var i=egret.localStorage.getItem(this._game_key+e);if(null==i)return t;switch(typeof t){case"boolean":return"true"==i;case"number":return Number(i)}return i},t.KEY_MUSIC_VOLUME="KEY_MUSIC_VOLUME",t.KEY_SOUND_VOLUME="KEY_SOUND_VOLUME",t.KEY_COIN_NUM="KEY_COIN_NUM",t.KEY_BEST_SCORE="KEY_BEST_SCORE",t}(SingletonClass);__reflect(LocalStorageMgr.prototype,"LocalStorageMgr");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function r(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?n(r):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var func;!function(e){function t(e){e&&e.parent&&e.parent.removeChild(e)}function i(e,t,i,n,r){void 0===r&&(r=egret.HttpMethod.GET);var o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT;var a="",s=!0;for(var l in t)s?s=!1:a+="&",a+=l+"="+t[l];o.open(r==egret.HttpMethod.GET?e+"?"+a:e,r),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r==egret.HttpMethod.GET?o.send():o.send(a),egret.log("sendUrl:"+e+"  \nsendParams:"+a),o.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget;if(t&&t.response){var r=JSON.parse(t.response);egret.log("request.response:"+t.response);var o=r.error_code,a=r.error||"ERROR";r&&0==o?i(r):n(o,a)}else n(-2,"NO_REQUEST")},this),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){n(-1,"IO_ERROR")},this)}function n(e,t,i){void 0===t&&(t=function(){}),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x+=e.width/2,e.y+=e.height/2,e.anchorOffsetY=e.height/2;var n=i?i:e;e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){egret.Tween.get(e).to({scaleX:.85,scaleY:.85},100)},n),e.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){egret.Tween.get(e).to({scaleX:1,scaleY:1},100)},n),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){egret.Tween.get(e).to({scaleX:1,scaleY:1},100)},n),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){egret.Tween.get(e).to({scaleX:1,scaleY:1},100),t&&t.call(n)},n)}function r(e){var t=e,i=window.screen.width/window.screen.height,n=egret.StageScaleMode.SHOW_ALL;egret.Capabilities.isMobile&&(n=egret.StageScaleMode.FIXED_WIDTH,(.56>i||i>.6)&&(n=egret.StageScaleMode.SHOW_ALL)),t.stage.scaleMode=n}function o(e,t){return(t.y-e.y)/(t.x-e.x)}function a(t,i){var n=Main.ins.mainView;if(n){var r=EffectMgr.ins().newMovieClip(EffectMgr.RES_EFFECT_COINT);r.x=t,r.y=i,n.layer_effect.addChild(r);var o=50,a=60;egret.Tween.get(r).to({scaleX:1.3,scaleY:1.3,x:o/2,y:a/2},600,egret.Ease.sineIn).to({scaleX:1,scaleY:1,x:o,y:a},600,egret.Ease.sineOut).call(function(){e.removeFromParent(r)})}}e.removeFromParent=t,e.sendHttpRequest=i,e.addButtonClickByEff=n,e.screenAdaptation=r,e.getPonitSlope=o,e.flyCoinEffect=a}(func||(func={}));var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),null==t.ins&&(t.ins=this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){egret.error(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return GameConst.init(),[4,this.loadResource()];case 1:return e.sent(),[4,new Promise(function(e,t){platform.login().then(function(t){e()},function(t){e()})})];case 2:return e.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 3:return e.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i=this;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,7,,8]),[4,new Promise(function(e,t){var n=new egret.HttpRequest;n.open("resource/default.res.json?v="+Math.random(),egret.HttpMethod.GET),n.send(),n.addEventListener(egret.Event.COMPLETE,function(t){t.currentTarget;e()},i),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){t("IO_ERROR")},i)})];case 1:return n.sent(),[4,RES.loadConfig("resource/default.res.json","resource/")];case 2:return n.sent(),[4,RES.loadGroup("loading",0)];case 3:return n.sent(),[4,new Promise(function(e,t){var n=new egret.HttpRequest;n.open("resource/default.thm.json?v="+Math.random(),egret.HttpMethod.GET),n.send(),n.addEventListener(egret.Event.COMPLETE,function(t){t.currentTarget;e()},i),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){t("IO_ERROR")},i)})];case 4:return n.sent(),[4,this.loadTheme()];case 5:return n.sent(),e=new LoadingUI,this.addChild(e),[4,RES.loadGroup("preload",0,e)];case 6:return n.sent(),this.removeChild(e),[3,8];case 7:return t=n.sent(),console.error(t),[3,8];case 8:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){RandomMgr.ins().init(),SoundMgr.ins().init(),this.mainView=new MainView,this.addChild(this.mainView),GameModel.ins().init(),GameMgr.ins().init()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var GameConst=function(){function e(){}return e.init=function(){e.randomSeed=Math.round(1e3+8999*Math.random()).toString()},e.isDebug=!1,e.appVersion="0.18091601",e.randomSeed="0123456789ABCDEF",e.cross_sdk_adsId="40oZ8pZvmW",e.cross_sdk_gameId="test-game",e.cross_sdk_env="Test",e.collisionGroup_ball=Math.pow(2,0),e.collisionGroup_wall=Math.pow(2,1),e.collisionGroup_brick=Math.pow(2,2),e.material_ball=new p2.Material(1),e.material_wall=new p2.Material(2),e.material_brick=new p2.Material(3),e.map_Rectangle=new egret.Rectangle(25,200,700,1e3),e.ball_radius=15,e.ball_fire_speed=2e3,e.ball_InitPos=[e.map_Rectangle.x+e.map_Rectangle.width/2,e.map_Rectangle.y+e.map_Rectangle.height-e.ball_radius],e.brick_radius=50,e.brick_speed=100,e}();__reflect(GameConst.prototype,"GameConst");var MainView=function(e){function t(){var t=e.call(this)||this;return t._views={},t.skinName="MainViewSkin",t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.percentWidth=this.percentHeight=100;for(var t=[{view:GameView,show:!0,parent:this.layer_base},{view:BeginView,show:!0,parent:this.layer_base},{view:GameOverView,show:!1,parent:this.layer_base},{view:GameTopView,show:!0,parent:this.layer_top}],i=0,n=t;i<n.length;i++){var r=n[i],o=egret.getQualifiedClassName(r.view);this._views[o]=new r.view,this._views[o].setParent(r.parent),r.show&&this._views[o].show()}},t.prototype.getView=function(e){return"string"==typeof e?this._views[e]:this._views[egret.getQualifiedClassName(e)]},t.prototype.showTips=function(e){var t=this;egret.Tween.removeTweens(this.gp_tips),this.gp_tips.visible=!0,this.gp_tips.alpha=1,this.lb_tips.text=e,egret.Tween.get(this.gp_tips).wait(500).to({alpha:0},1e3).call(function(){t.gp_tips.visible=!1})},t}(eui.Component);__reflect(MainView.prototype,"MainView",["eui.UIComponent","egret.DisplayObject"]);var ViewMgr;!function(e){function t(){return Main.ins.mainView}e.ins=t}(ViewMgr||(ViewMgr={}));var EffectMgr=function(e){function t(){var t=e.call(this)||this;return t._effectReses={},t._effectFactory={},t}return __extends(t,e),t.ins=function(){return e.ins.call(this)},t.prototype.init=function(){this._effectReses={}},t.prototype.getMovieClip=function(e){return this._effectReses[e]||(this._effectReses[e]=this.newMovieClip(e)),this._effectReses[e]},t.prototype.newMovieClip=function(e){if(!this._effectFactory[e]){var t=RES.getRes(e+"_json"),i=RES.getRes(e+"_png");this._effectFactory[e]=new egret.MovieClipDataFactory(t,i)}var n=this._effectFactory[e],r=new egret.MovieClip(n.generateMovieClipData(e));return r.addEventListener(egret.Event.COMPLETE,function(e){func.removeFromParent(r)},this),r.touchEnabled=!1,r},t.RES_EFFECT_COINT="effect_coin",t}(SingletonClass);__reflect(EffectMgr.prototype,"EffectMgr");var GameStatus;!function(e){e[e.Ready=1]="Ready",e[e.Onfire=2]="Onfire",e[e.GameOver=3]="GameOver"}(GameStatus||(GameStatus={}));var GameMgr=function(e){function t(){var t=e.call(this)||this;return t._world=new p2.World,t._balls=[],t._bricks=[],t._walls=[],t._ballInitPos=[GameConst.ball_InitPos[0],GameConst.ball_InitPos[1]],t._status=GameStatus.Ready,t._fireEndBallCount=0,t._nextLevelReferY=0,t._p2wordFrame=1,t._fireTimer=egret.getTimer(),t._fireBallPos=new egret.Point(0,0),t}return __extends(t,e),t.ins=function(){return e.ins.call(this)},Object.defineProperty(t.prototype,"bricks",{get:function(){return this._bricks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ballInitPos",{get:function(){return this._ballInitPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._world},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){this._status=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fireEndBallCount",{get:function(){return this._fireEndBallCount},set:function(e){this._fireEndBallCount=e},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._mainView=Main.ins.mainView,this._gameView=this._mainView.getView(GameView),this.initWorld(),egret.startTick(this.enterFrame,this)},t.prototype.initWorld=function(){var e=this;this._world.gravity=[0,0],this._world.applyDamping=!1,this._walls=this.createWall(GameConst.map_Rectangle);var t={restitution:1,stiffness:Number.MAX_VALUE,friction:1};this._world.addContactMaterial(new p2.ContactMaterial(GameConst.material_ball,GameConst.material_wall,t)),this._world.addContactMaterial(new p2.ContactMaterial(GameConst.material_ball,GameConst.material_brick,t)),this._world.on("beginContact",function(t){var i,n=t.bodyA,r=t.bodyB;n instanceof BallItem&&r==e._walls[2]?i=n:r instanceof BallItem&&n==e._walls[2]&&(i=r),i&&i.status==BallStatus.onfire&&(i.resetBall(),i.status=BallStatus.onland,e.fireEndBallCount++),n instanceof BallItem&&r instanceof BrickItem?r.impactBall(n):r instanceof BallItem&&n instanceof BrickItem&&n.impactBall(r)})},t.prototype.resetGame=function(){GameModel.ins().resetData(),this._gameView.resetView(),this._ballInitPos=[GameConst.ball_InitPos[0],GameConst.ball_InitPos[1]];for(var e=0,t=this._balls;e<t.length;e++){var i=t[e];i.dispose()}for(var n=0,r=this._bricks;n<r.length;n++){var o=r[n];o.dispose()}this._bricks=[],this._balls=[];for(var a=0;4>a;a++)this.createBallItem();this.status=GameStatus.Onfire,this.fireEndBallCount=0,this._p2wordFrame=1,this.nextLevel()},t.prototype.nextLevel=function(){var e=GameConst.map_Rectangle;if(this.status!=GameStatus.GameOver){for(var t=0;t<this._bricks.length;t++){var i=this._bricks[t];i.world||(this._bricks.splice(t,1),t--)}for(var n=-1*GameConst.brick_radius+e.y+e.height,r=0,o=this._bricks;r<o.length;r++){var i=o[r];if(i.position[1]>=n){for(var a=0,s=this._balls;a<s.length;a++){var l=s[a];l.resetBall(),l.position[0]=this._ballInitPos[0],l.status=BallStatus.ready}for(var c=0,h=this._bricks;c<h.length;c++){var p=h[c];p.velocity=[0,0]}return this.showGameOverView(),void(this.status=GameStatus.GameOver)}}GameModel.ins().level++;var u=Math.floor(e.width/(2*GameConst.brick_radius)),d=RandomMgr.ins().randomNum(0,(u-1)*Math.ceil(GameModel.ins().level/50)),_=RandomMgr.ins().randomNum(0,3*u);this._nextLevelReferY=e.y-GameConst.brick_radius;var f=-1;GameModel.ins().level%10==0&&(f=RandomMgr.ins().randomNum(0,u-1));for(var t=0;u>t;t++){var g=[e.x+(2*t+1)*GameConst.brick_radius,this._nextLevelReferY];if(t==f)this.createBrickItem(g,RandomMgr.ins().randomNum(GameModel.ins().level,3*GameModel.ins().level),BrickEffectType.coin,BrickShapeType.circle);else if(t==d)this.createBrickItem(g,RandomMgr.ins().randomNum(1,GameModel.ins().level/10),BrickEffectType.ball,BrickShapeType.circle);else if(t==_)this.createBrickItem(g,RandomMgr.ins().randomNum(1,GameModel.ins().level/10),RandomMgr.ins().randomNum(BrickEffectType.row_and_col,BrickEffectType.col),BrickShapeType.square);else{var m=RandomMgr.ins().randomNum(2*-GameModel.ins().level,2.5*GameModel.ins().level);if(m>0)var i=this.createBrickItem(g,m,BrickEffectType.normal,RandomMgr.ins().randomNum(BrickShapeType.square,BrickShapeType.hexagon))}}this._gameView.nextLevelView()}},t.prototype.showGameOverView=function(){var e=this._mainView.getView(GameOverView);e.show()},t.prototype.enterFrame=function(e){var t=egret.getTimer(),i=GameConst.map_Rectangle;this._world.step(.01),this._nextLevelReferY+=.01*GameConst.brick_speed,this._gameView.update();for(var n=0;n<this._world.bodies.length;n++){var r=this._world.bodies[n];if(r.displays)for(var o=0,a=r.displays;o<a.length;o++){var s=a[o];s.parent!=this._gameView.gp_map&&(this._gameView.gp_map.addChild(s),s.x=r.position[0],s.y=r.position[1]),(s.x!=r.position[0]||s.y!=r.position[1])&&(s.x=r.position[0],s.y=r.position[1]),s.rotation=180*r.angle/Math.PI}}if(this.status==GameStatus.Onfire&&this._nextLevelReferY>=i.y+GameConst.brick_radius&&this.nextLevel(),t-this._fireTimer>50){this._fireTimer=t,this.fireOneBall();for(var l=0,c=this._balls;l<c.length;l++){var h=c[l];switch(h.status){case BallStatus.onland:break;case BallStatus.onfire:if(0==h.velocity[0]&&0==h.velocity[1])h.status=BallStatus.onland,h.resetBall(),0==this.fireEndBallCount?this._ballInitPos[0]=h.position[0]:h.position=[this._ballInitPos[0],this._ballInitPos[1]],this.fireEndBallCount++;else{Math.abs(h.velocity[1])<GameConst.ball_radius&&(h.velocity[1]=h.velocity[1]>=0?GameConst.ball_radius:-GameConst.ball_radius);var p=h.velocity[0],u=h.velocity[1],d=GameConst.ball_fire_speed/Math.sqrt(p*p+u*u);Math.abs(d-1)>.01&&(h.velocity=[p*d,u*d])}}}}},t.prototype.reliveGame=function(){for(var e=0,t=this._bricks;e<t.length;e++){var i=t[e];i.dispose()}this._bricks=[],this.status=GameStatus.Onfire,this.nextLevel()},t.prototype.createWall=function(e){var t=[],i=e.height+GameConst.ball_radius+55;return t.push(this.createPlane(0,e.x,e.y)),t.push(this.createPlane(-Math.PI/2,e.x,e.y)),t.push(this.createPlane(Math.PI,e.x,e.y+i)),t.push(this.createPlane(Math.PI/2,e.x+e.width,e.y)),t},t.prototype.createPlane=function(e,t,i){void 0===e&&(e=Math.PI);var n=new p2.Plane,r=new p2.Body({mass:0,type:p2.Body.STATIC});return n.collisionGroup=GameConst.collisionGroup_wall,n.material=GameConst.material_wall,r.addShape(n),r.angle=e,r.position[0]=t,r.position[1]=i,this.world.addBody(r),r},t.prototype.createBallItem=function(e,t){void 0===e&&(e=[this._ballInitPos[0],this._ballInitPos[1]]),void 0===t&&(t=[0,0]);var i=new BallItem({position:e,mass:1,velocity:t});return this._world.addBody(i),this._balls.push(i),GameModel.ins().ballCount++,i},t.prototype.createBrickItem=function(e,t,i,n){void 0===i&&(i=BrickEffectType.normal),void 0===n&&(n=BrickShapeType.square);var r=new BrickItem({position:e,hp:t,brickEffectType:i,brickShapType:n});this._world.addBody(r);for(var o=0,a=r.displays||[];o<a.length;o++){var s=a[o];this._gameView.gp_map.addChild(s),s.x=e[0],s.y=e[1]}return this._bricks.push(r),r},t.prototype.fireBallDir=function(e,t){this._fireBallPos.x=e,this._fireBallPos.y=t},t.prototype.fireOneBall=function(){if(this.status==GameStatus.Onfire)for(var e=0,t=this._balls;e<t.length;e++){var i=t[e];if(i.status==BallStatus.ready){i.status=BallStatus.onfire;var n=this._fireBallPos.x-i.position[0],r=this._fireBallPos.y-i.position[1],o=GameConst.ball_fire_speed/Math.sqrt(n*n+r*r);i.velocity=[n*o,r*o];break}}},t}(SingletonClass);__reflect(GameMgr.prototype,"GameMgr");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingUISkin",t}return __extends(t,e),t.prototype.onProgress=function(e,t){this.img_progress&&(this.img_progress.width=596*(e/t))},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.horizontalCenter=this.verticalCenter=0,this.lb_version.text="version:"+GameConst.appVersion},t}(BaseView);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var RandomSeedType;!function(e){e[e.UNDEFINE=0]="UNDEFINE"}(RandomSeedType||(RandomSeedType={}));var RandomMgr=function(e){function t(){var t=e.call(this)||this;return t._seeds=[],t._seedIndex=[],t._selectedIndexes=[],t}return __extends(t,e),t.ins=function(){return e.ins.call(this)},t.prototype.init=function(){var e=[RandomSeedType.UNDEFINE];this._seeds=[],this._selectedIndexes=[],this._seedIndex=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];this._seeds[n]=[],this._selectedIndexes[n]=[],this._seedIndex[n]=0}for(var r=0;r<GameConst.randomSeed.length;r++){var o=parseInt(GameConst.randomSeed[r],36)||0;o=(9301*o+49297)%1048576||0;for(var a=0,s=e;a<s.length;a++){var n=s[a];this._seeds[n].push(o)}}},t.prototype.randomNum=function(e,t,i){void 0===i&&(i=RandomSeedType.UNDEFINE),e>t&&(t=e);var n=this._seedIndex[i]%GameConst.randomSeed.length,r=e+this._seeds[i][n]%(t-e+1);return this._seeds[i][n]=(9301*this._seeds[i][n]+49297)%1048576||0,this._seedIndex[i]++,this._selectedIndexes[i].push(r),Math.round(r)},t}(SingletonClass);__reflect(RandomMgr.prototype,"RandomMgr");var SoundMgr=function(e){function t(){var t=e.call(this)||this;return t._isPlayMusic=!1,t._musicVolume=1,t._soundVolume=1,t._soundReses={},t}return __extends(t,e),Object.defineProperty(t.prototype,"musicVolume",{get:function(){return this._musicVolume},set:function(e){this._musicVolume=e,this._isPlayMusic&&(this._bgChannel.volume=e),LocalStorageMgr.ins().setLocal(LocalStorageMgr.KEY_MUSIC_VOLUME,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"soundVolume",{get:function(){return this._soundVolume},set:function(e){this._soundVolume=e,this._isPlayMusic&&(this._bgChannel.volume=e),LocalStorageMgr.ins().setLocal(LocalStorageMgr.KEY_SOUND_VOLUME,e)},enumerable:!0,configurable:!0}),t.ins=function(){return e.ins.call(this)},t.prototype.init=function(){this._soundReses={}},t.prototype.resetData=function(){this.changeBg(t.RES_BG)},t.prototype.playSoundEffect=function(e){this._soundReses[e]||(this._soundReses[e]=RES.getRes(e));var t=this._soundReses[e];if(t&&t.play){var i=t.play(0,1);i.volume=this._soundVolume}},t.prototype.playBg=function(e){void 0===e&&(e=!0),this._isPlayMusic=e,this._bgChannel&&(this._bgChannel.volume=e?this._musicVolume:0)},t.prototype.changeBg=function(e){this._bgChannel&&this._bgChannel.stop();var t=RES.getRes(e);t&&t.play&&(this._bgChannel=t.play(),this._bgChannel.volume=this._isPlayMusic?this._musicVolume:0)},t.RES_V_DOWN="v_down_mp3",t.RES_BG="bg_mp3",t}(SingletonClass);__reflect(SoundMgr.prototype,"SoundMgr");var GameModel=function(e){function t(){var t=e.call(this)||this;return t._totalScore=0,t._bestScore=0,t._level=0,t._leftReliveCount=0,t._theme=1,t._ballCount=0,t._coin=0,t}return __extends(t,e),t.ins=function(){return e.ins.call(this)},Object.defineProperty(t.prototype,"totalScore",{get:function(){return this._totalScore},set:function(e){this._totalScore;this._totalScore=e,e>this.bestScore&&(this.bestScore=e),this._gameView.updateScoreView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bestScore",{get:function(){return this._bestScore},set:function(e){this._bestScore;this._bestScore=e;var t=ViewMgr.ins().getView(GameTopView);t.updateBestScore()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(e){this._level;this._level=e,this._gameView.updateLevelView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftReliveCount",{get:function(){return this._leftReliveCount},set:function(e){this._leftReliveCount;this._leftReliveCount=e;var t=Main.ins.mainView.getView(GameOverView);t.updateReliveView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theme",{get:function(){return this._theme},set:function(e){this._theme;this._theme=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ballCount",{get:function(){return this._ballCount},set:function(e){this._ballCount;this._ballCount=e,this._gameView.updateBallCountView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coin",{get:function(){return this._coin},set:function(e){this._coin=e,LocalStorageMgr.ins().setLocal(LocalStorageMgr.KEY_COIN_NUM,e);var t=Main.ins.mainView.getView(GameTopView);t.updateCoinNum()},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.coin=LocalStorageMgr.ins().getLocal(LocalStorageMgr.KEY_COIN_NUM,0),this.bestScore=LocalStorageMgr.ins().getLocal(LocalStorageMgr.KEY_BEST_SCORE,0),this._gameView=Main.ins.mainView.getView(GameView),this.resetData()},t.prototype.resetData=function(){this.level=0,this.ballCount=0,this.totalScore=0,this.leftReliveCount=1},t}(SingletonClass);__reflect(GameModel.prototype,"GameModel");var BeginView=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.addTouchTapEvent(this.btn_share,function(){platform.share().then(function(){GameModel.ins().coin=GameModel.ins().coin+20},function(){})}),this.addTouchTapEvent(this.btn_start,function(){t.hide(),GameMgr.ins().resetGame()})},t}(BaseView);__reflect(BeginView.prototype,"BeginView");var GameOverView=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.addTouchTapEvent(this.btn_reset,function(){t.hide();var e=Main.ins.mainView.getView(BeginView);e.show()}),this.addTouchTapEvent(this.btn_share,function(){platform.share().then(function(){GameModel.ins().coin=GameModel.ins().coin+20},function(){})}),this.coinbtn_relive.successCallback=function(){GameModel.ins().leftReliveCount--,t.hide(),GameMgr.ins().reliveGame()},this.coinbtn_relive.costNum=50,this.updateReliveView()},t.prototype.updateReliveView=function(){this.coinbtn_relive&&(this.coinbtn_relive.visible=GameModel.ins().leftReliveCount>0)},t}(BaseView);__reflect(GameOverView.prototype,"GameOverView");var GameTopView=function(e){function t(){var t=e.call(this)||this;return t._needBlackBg=!1,t._needShowEffect=!1,t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.touchEnabled=!1},t.prototype.updateCoinNum=function(){var e=GameModel.ins().coin;this.lb_coin_num.text=""+e},t.prototype.updateBestScore=function(){var e=GameModel.ins().bestScore;this.lb_best_score.text="best:"+e},t}(BaseView);__reflect(GameTopView.prototype,"GameTopView");var GameView=function(e){function t(){var t=e.call(this)||this;return t._img_dangers=[],t._img_guide_points=[],t.skinName="GameViewSkin",t._needShowEffect=!1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.createDebugView(),this.init(),this.lb_version.text="v."+GameConst.appVersion,this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchCancel,this),this.addTouchTapEvent(this.btn_reset,function(){GameMgr.ins().resetGame()})},t.prototype.createDebugView=function(){this._p2DebugView=new P2DebugDrawView(GameMgr.ins().world);var e=new egret.Sprite;this.gp_test.addChild(e),this._p2DebugView.setSprite(e)},t.prototype.init=function(){var e=GameConst.map_Rectangle,t=GameConst.brick_radius;this.gp_touch.x=GameConst.map_Rectangle.x,this.gp_touch.y=GameConst.map_Rectangle.y,this.gp_touch.width=GameConst.map_Rectangle.width,this.gp_touch.height=GameConst.map_Rectangle.height,this.gp_touch.height=this.gp_touch.height-GameConst.brick_radius,this.img_game_mask_top.height=e.y,this.img_game_mask_bot.y=e.y+e.height,this.lb_ball_count.x=this.img_canno.x=GameMgr.ins().ballInitPos[0],this.lb_ball_count.y=this.img_canno.y=GameMgr.ins().ballInitPos[1];for(var i=e.width/(2*t),n=0;i>n;n++){var r=[e.x+(2*n+1)*t,-1*t+e.y+e.height],o=new eui.Image("gameTexture_json.img_danger");o.visible=o.touchEnabled=!1,o.width=o.height=2*t,o.anchorOffsetX=o.anchorOffsetY=t,o.x=r[0],o.y=r[1],this.gp_map.addChild(o),this._img_dangers.push(o)}for(var n=0;40>n;n++){var o=new eui.Image("gameTexture_json.game_img_guildline_0");o.visible=o.touchEnabled=!1,o.width=o.height=16,o.anchorOffsetX=o.anchorOffsetY=8,this.gp_map.addChild(o),this._img_guide_points.push(o)}},t.prototype.updateLevelView=function(){var e=GameModel.ins().level;this.lb_level.text=""+e},t.prototype.updateBallCountView=function(){this.lb_ball_count.text=""+GameModel.ins().ballCount},t.prototype.updateScoreView=function(){var e=GameModel.ins().totalScore;this.lb_score.text=""+e},t.prototype.resetView=function(){var e=GameConst.map_Rectangle;this.calculateGuidePointsLine(e.x+e.width/2,e.y)},t.prototype.nextLevelView=function(){for(var e=GameConst.map_Rectangle,t=-3*GameConst.brick_radius+e.y+e.height,i=0,n=this._img_dangers;i<n.length;i++){var r=n[i];r.visible=!1,egret.Tween.removeTweens(r),r.alpha=1}for(var o=0,a=GameMgr.ins().bricks;o<a.length;o++){var s=a[o];if(s.position[1]>=t){for(var l=0,c=this._img_dangers;l<c.length;l++){var r=c[l];r.visible=!0,egret.Tween.get(r,{loop:!0}).to({alpha:0},1e3)}break}}},t.prototype.playAddSpeedEffect=function(){for(var e=egret.Tween.get(this.img_add_speed),t=0;2>t;t++)e=e.to({alpha:1},500).to({alpha:0},500)},t.prototype.onTouchBegin=function(e){this.calculateGuidePointsLine(e.stageX,e.stageY)},t.prototype.onTouchMove=function(e){this.calculateGuidePointsLine(e.stageX,e.stageY)},t.prototype.onTouchTap=function(e){},t.prototype.onTouchCancel=function(e){},t.prototype.calculateGuidePointsLine=function(e,t){var i=GameConst.map_Rectangle,n=GameMgr.ins().ballInitPos,r=n[0],o=n[1],a=(t-o)/(e-r),s=o-r*a,l=(i.y-s)/a;l=l<i.x?i.x:l>i.x+i.width?i.x+i.width:l;for(var c=(l-r)/this._img_guide_points.length*1.5,h=0;h<this._img_guide_points.length;h++){var p=this._img_guide_points[h];p.x=r+c*h,p.y=a*p.x+s,p.x<i.x?p.x=2*i.x-p.x:p.x>i.x+i.width&&(p.x=2*(i.x+i.width)-p.x),p.y<i.y&&(p.y=2*i.y-p.y),p.visible=!0}GameMgr.ins().fireBallDir(e,t);var u=0;
if(r==e)u=o>=t?-0:180;else{var d=(t-o)/(e-r);u=180*Math.atan(d)/Math.PI+(r>e?-90:90)}this.img_canno.rotation=u},t.prototype.update=function(){},t}(BaseView);__reflect(GameView.prototype,"GameView");var P2DebugDrawView=function(){function e(e){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=10329589,this.COLOR_S=8381823,this.lineWidth=1,this.world=e}return e.prototype.setSprite=function(e){this.sprite=e},e.prototype.setLineWidth=function(e){this.lineWidth=e},e.prototype.drawDebug=function(){this.sprite.graphics.clear();for(var e=this.world.bodies.length,t=0;e>t;t++)for(var i=this.world.bodies[t],n=0;n<i.shapes.length;n++){var r=i.shapes[n];r instanceof p2.Box?this.drawBox(r,i):r instanceof p2.Convex?this.drawConvex(r,i):r instanceof p2.Circle?this.drawCircle(r,i):r instanceof p2.Line?this.drawLine(r,i):r instanceof p2.Particle?this.drawParticle(r,i):r instanceof p2.Plane?this.drawPlane(r,i):r instanceof p2.Capsule?this.drawCapsule(r,i):r instanceof p2.Heightfield&&this.drawHeightfield(r,i)}},e.prototype.drawRay=function(e,t,i){var n=this.sprite.graphics;n.lineStyle(this.lineWidth,i),n.moveTo(e[0],e[1]),n.lineTo(t[0],t[1]),n.endFill()},e.prototype.drawBox=function(e,t){this.drawConvex(e,t)},e.prototype.drawCircle=function(e,t){var i=this.getColor(t),n=this.sprite.graphics;n.lineStyle(this.lineWidth,i),n.beginFill(i,.5);var r=e.position[0],o=e.position[1],a=[];t.toWorldFrame(a,[r,o]),n.drawCircle(a[0],a[1],e.radius);var s=r+e.radius,l=o+0,c=new Array;t.toWorldFrame(c,[s,l]),n.moveTo(a[0],a[1]),n.lineTo(c[0],c[1]),n.endFill()},e.prototype.drawCapsule=function(e,t){var i=this.getColor(t),n=e.position[0],r=e.position[1],o=e.angle,a=e.length,s=e.radius,l=new Array,c=new Array,h=new Array,p=new Array,u=new Array,d=new Array;p2.vec2.rotate(l,[-a/2,-s],o),p2.vec2.rotate(c,[a/2,-s],o),p2.vec2.rotate(h,[a/2,s],o),p2.vec2.rotate(p,[-a/2,s],o),p2.vec2.rotate(u,[a/2,0],o),p2.vec2.rotate(d,[-a/2,0],o);var _=new Array,f=new Array,g=new Array,m=new Array,v=new Array,y=new Array;t.toWorldFrame(_,[n+l[0],r+l[1]]),t.toWorldFrame(f,[n+c[0],r+c[1]]),t.toWorldFrame(g,[n+h[0],r+h[1]]),t.toWorldFrame(m,[n+p[0],r+p[1]]),t.toWorldFrame(v,[n+u[0],r+u[1]]),t.toWorldFrame(y,[n+d[0],r+d[1]]);var w=this.sprite.graphics;w.lineStyle(this.lineWidth,i),w.beginFill(i,.5),w.drawCircle(v[0],v[1],s),w.endFill(),w.lineStyle(this.lineWidth,i),w.beginFill(i,.5),w.drawCircle(y[0],y[1],s),w.endFill(),w.lineStyle(this.lineWidth,i),w.beginFill(i,.5),w.moveTo(_[0],_[1]),w.lineTo(f[0],f[1]),w.lineTo(g[0],g[1]),w.lineTo(m[0],m[1]),w.endFill()},e.prototype.drawLine=function(e,t){var i=this.getColor(t),n=e.position[0],r=e.position[1],o=e.angle,a=e.length,s=new Array,l=new Array;p2.vec2.rotate(s,[-a/2,0],o),p2.vec2.rotate(l,[a/2,0],o);var c=[],h=[];t.toWorldFrame(c,[n+s[0],r+s[1]]),t.toWorldFrame(h,[n+l[0],r+l[1]]);var p=this.sprite.graphics;p.lineStyle(this.lineWidth,i),p.moveTo(c[0],c[1]),p.lineTo(h[0],h[1]),p.endFill()},e.prototype.drawHeightfield=function(e,t){var i=this.getColor(t),n=e.heights,r=n.length,o=e.elementWidth;if(r>0){var a=e.position[0],s=e.position[1],l=[],c=[],h=0,p=this.sprite.graphics;p.lineStyle(this.lineWidth,i),p.beginFill(i,.5),t.toWorldFrame(c,[a+h,s-100]),p.moveTo(c[0],c[1]);for(var u=0;r>u;u++){var d=n[u];t.toWorldFrame(l,[a+h+u*o,s+d]),p.lineTo(l[0],l[1])}t.toWorldFrame(l,[a+h+r*o,s-100]),p.lineTo(l[0],l[1]),p.endFill()}},e.prototype.drawParticle=function(e,t){var i=this.getColor(t),n=this.sprite.graphics;n.lineStyle(this.lineWidth,i),n.beginFill(i,.5);var r=e.position[0],o=e.position[1],a=t.position[0]+r,s=t.position[1]+o;n.drawCircle(a,s,this.lineWidth),n.endFill(),n.lineStyle(this.lineWidth,i),n.drawCircle(a,s,5*this.lineWidth),n.endFill()},e.prototype.drawConvex=function(e,t){var i=this.getColor(t),n=e.vertices.length,r=this.sprite.graphics;r.lineStyle(this.lineWidth,i),r.beginFill(i,.5);var o=e.position[0],a=e.position[1],s=new Array;t.toWorldFrame(s,[o,a]);var l=e.vertices[0],c=[o+l[0],a+l[1]],h=new Array;t.toWorldFrame(h,c),r.moveTo(s[0],s[1]),r.lineTo(h[0],h[1]);for(var p=1;n>=p;p++)l=e.vertices[p%n],c=[o+l[0],a+l[1]],t.toWorldFrame(h,c),r.lineTo(h[0],h[1]);r.endFill()},e.prototype.drawPlane=function(e,t){var i=this.COLOR_D_SLEEP,n=this.sprite.graphics;n.lineStyle(this.lineWidth,i),n.beginFill(i,1);var r=e.position[0],o=e.position[1],a=e.angle,s=new Array,l=new Array,c=[],h=[];p2.vec2.rotate(s,[-1e3,0],a),t.toWorldFrame(c,[r+s[0],o+s[1]]),n.moveTo(c[0],c[1]),p2.vec2.rotate(l,[1e3,0],a),t.toWorldFrame(h,[r+l[0],o+l[1]]),n.lineTo(h[0],h[1]),p2.vec2.rotate(l,[1e3,-1e3],a),t.toWorldFrame(h,[r+l[0],o+l[1]]),n.lineTo(h[0],h[1]),p2.vec2.rotate(l,[-1e3,-1e3],a),t.toWorldFrame(h,[r+l[0],o+l[1]]),n.lineTo(h[0],h[1]),p2.vec2.rotate(l,[-1e3,-0],a),t.toWorldFrame(h,[r+l[0],o+l[1]]),n.lineTo(h[0],h[1]),n.endFill()},e.prototype.getColor=function(e){var t=this.COLOR_D_SLEEP;return e.type==p2.Body.KINEMATIC?t=this.COLOR_K:e.type==p2.Body.STATIC?t=this.COLOR_S:e.sleepState==p2.Body.AWAKE&&(t=this.COLOR_D_WAKE),t},e}();__reflect(P2DebugDrawView.prototype,"P2DebugDrawView");var BallStatus;!function(e){e[e.ready=1]="ready",e[e.onfire=2]="onfire",e[e.onland=3]="onland"}(BallStatus||(BallStatus={}));var BallItem=function(e){function t(t){var i=e.call(this,t)||this;return i._status=BallStatus.ready,i.addShape(new p2.Circle({radius:GameConst.ball_radius,material:GameConst.material_ball})),i.shapes[0].collisionGroup=GameConst.collisionGroup_ball,i.shapes[0].collisionMask=GameConst.collisionGroup_wall|GameConst.collisionGroup_brick,i.inertia=0,i._img_ball=new eui.Image("ballTexture_json.ball1"),i._img_ball.touchEnabled=!1,i._img_ball.width=i._img_ball.height=2*GameConst.ball_radius,i._img_ball.anchorOffsetX=i._img_ball.anchorOffsetY=GameConst.ball_radius,i.displays=[i._img_ball],i}return __extends(t,e),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){var t=this;switch(this._status=e,e){case BallStatus.ready:this.collisionResponse=!1;break;case BallStatus.onfire:this.collisionResponse=!0;break;case BallStatus.onland:egret.Tween.get(this).to({position0:GameMgr.ins().ballInitPos[0],position1:GameMgr.ins().ballInitPos[1]},Math.sqrt(Math.pow(this.position[1]-GameMgr.ins().ballInitPos[1],2)+Math.pow(this.position[0]-GameMgr.ins().ballInitPos[0],2))).call(function(){t.status=BallStatus.ready})}},enumerable:!0,configurable:!0}),t.prototype.resetBall=function(){var e=GameConst.map_Rectangle;this.setZeroForce(),this.velocity=[0,0],this.position[0]<e.x+GameConst.ball_radius?this.position[0]=e.x+GameConst.ball_radius:this.position[0]>e.x+e.width-GameConst.ball_radius&&(this.position[0]=e.x+e.width-GameConst.ball_radius),this.position[1]=GameMgr.ins().ballInitPos[1]},t}(BaseP2Body);__reflect(BallItem.prototype,"BallItem");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){e()})]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){t()})]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var BrickEffectType;!function(e){e[e.normal=1]="normal",e[e.ball=2]="ball",e[e.row_and_col=3]="row_and_col",e[e.row=4]="row",e[e.col=5]="col",e[e.coin=6]="coin"}(BrickEffectType||(BrickEffectType={}));var BrickShapeType;!function(e){e[e.square=1]="square",e[e.circle=2]="circle",e[e.hexagon=3]="hexagon"}(BrickShapeType||(BrickShapeType={}));var BrickItem=function(e){function t(t){var i=e.call(this,t)||this;return i._img_shape=new eui.Image,i._hp=0,i._brickEffectType=BrickEffectType.normal,i._brickShapType=BrickShapeType.square,i.displays=[],i._brickEffectType=t.brickEffectType||BrickEffectType.normal,i._brickShapType=t.brickShapType||BrickShapeType.square,i.getShape(),i.inertia=0,i._lb_hp=new eui.Label(""+i._hp),i._lb_hp.style="brick_hp",i._lb_hp.width=i._lb_hp.height=200,i._lb_hp.touchEnabled=!1,i._lb_hp.anchorOffsetX=i._lb_hp.anchorOffsetY=100,i.hp=t.hp||1,i.displays.push(i._lb_hp),i.velocity[1]=GameConst.brick_speed,i}return __extends(t,e),Object.defineProperty(t.prototype,"hp",{get:function(){return this._hp},set:function(e){this._img_shape.source="brickTexture_json."+GameModel.ins().theme+"-"+(Math.floor(e/5)%5+1)+"-"+this._brickShapType;var t=this._hp;this._hp=e,this._lb_hp.text=""+e,t>e&&(GameModel.ins().totalScore+=t-e,egret.Tween.get(this.displays[0]).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:1,scaleY:1},100)),0>=e&&this.dispose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"brickEffectType",{get:function(){return this._brickEffectType},enumerable:!0,configurable:!0}),t.prototype.getShape=function(){var e;this._img_shape.touchEnabled=!1;var t=GameConst.brick_radius;switch(this._img_shape.width=this._img_shape.height=2*t,this._img_shape.anchorOffsetX=this._img_shape.anchorOffsetY=t,this._brickShapType){case BrickShapeType.circle:e=new p2.Circle({radius:t,material:GameConst.material_brick});break;case BrickShapeType.square:e=new p2.Box({width:2*t,height:2*t,material:GameConst.material_brick});break;case BrickShapeType.hexagon:var i=t/2*Math.sqrt(3),n=t/2;e=new p2.Convex({vertices:[[-n,-i],[n,-i],[t,0],[n,i],[-t,0]],material:GameConst.material_brick}),this.angularVelocity=RandomMgr.ins().randomNum(-5,5)||1}e&&(e.collisionGroup=GameConst.collisionGroup_brick,this.addShape(e),this.displays.push(this._img_shape));var r;switch(this._brickEffectType){case BrickEffectType.ball:r=new eui.Image("ballTexture_json.ball1"),r.width=r.height=2*GameConst.ball_radius;break;case BrickEffectType.row_and_col:r=new eui.Image("gameTexture_json.img_brick_effect_row_col"),r.width=r.height=GameConst.brick_radius;break;case BrickEffectType.col:r=new eui.Image("gameTexture_json.img_brick_effect_col"),r.width=r.height=GameConst.brick_radius;break;case BrickEffectType.row:r=new eui.Image("gameTexture_json.img_brick_effect_row"),r.width=r.height=GameConst.brick_radius;break;case BrickEffectType.coin:r=new eui.Image("gameTexture_json.coin"),r.width=r.height=GameConst.brick_radius}r&&(r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height-this._img_shape.height/2,this.displays.push(r))},t.prototype.impactBall=function(e){var t=GameConst.map_Rectangle;if(1==this.hp)switch(this._brickEffectType){case BrickEffectType.ball:this.hp--;var i=GameMgr.ins().createBallItem(this.position,[0,GameConst.ball_fire_speed]);i.status=BallStatus.onfire;break;case BrickEffectType.row_and_col:if(this._img_shape.parent){var n=new eui.Image("razer_v");this._img_shape.parent.addChild(n),n.height=t.height,n.width=2*GameConst.ball_radius,n.anchorOffsetX=n.width/2,n.x=this._img_shape.x,n.y=t.y,egret.Tween.get(n).to({alpha:0},500).call(function(){func.removeFromParent(n)});var r=new eui.Image("razer_h");this._img_shape.parent.addChild(r),r.height=2*GameConst.ball_radius,r.width=t.width,r.anchorOffsetY=r.height/2,r.y=this._img_shape.y,r.x=t.x,egret.Tween.get(r).to({alpha:0},500).call(function(){func.removeFromParent(r)})}for(var o=0,a=GameMgr.ins().bricks;o<a.length;o++){var s=a[o];s.brickEffectType==BrickEffectType.normal&&(s.position[0]===this.position[0]||s.position[1]===this.position[1])&&(s.hp=0)}this.hp--;break;case BrickEffectType.col:if(this._img_shape.parent){var l=new eui.Image("razer_v");this._img_shape.parent.addChild(l),l.height=t.height,l.width=2*GameConst.ball_radius,l.anchorOffsetX=l.width/2,l.x=this._img_shape.x,l.y=t.y,egret.Tween.get(l).to({alpha:0},500).call(function(){func.removeFromParent(l)})}for(var c=0,h=GameMgr.ins().bricks;c<h.length;c++){var s=h[c];s.brickEffectType==BrickEffectType.normal&&s.position[0]===this.position[0]&&(s.hp=0)}this.hp--;break;case BrickEffectType.row:if(this._img_shape.parent){var p=new eui.Image("razer_h");this._img_shape.parent.addChild(p),p.height=2*GameConst.ball_radius,p.width=t.width,p.anchorOffsetY=p.height/2,p.y=this._img_shape.y,p.x=t.x,egret.Tween.get(p).to({alpha:0},500).call(function(){func.removeFromParent(p)})}for(var u=0,d=GameMgr.ins().bricks;u<d.length;u++){var s=d[u];s.brickEffectType==BrickEffectType.normal&&s.position[1]===this.position[1]&&(s.hp=0)}this.hp--;break;case BrickEffectType.coin:func.flyCoinEffect(this.position[0],this.position[1]),GameModel.ins().coin++,this.hp--;case BrickEffectType.normal:this.hp--}else this.hp--},t}(BaseP2Body);__reflect(BrickItem.prototype,"BrickItem");var UseCoinButton=function(e){function t(){var t=e.call(this)||this;return t._costNum=0,t._successCallback=function(){},t}return __extends(t,e),Object.defineProperty(t.prototype,"costNum",{set:function(e){this._costNum=e,this.lb_cost.text=""+e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"successCallback",{set:function(e){this._successCallback=e},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=GameModel.ins().coin;e>=t._costNum?(GameModel.ins().coin-=t._costNum,t._successCallback()):Main.ins.mainView.showTips("金币不足，快去游戏中获取金币吧！")},this)},t}(eui.Button);__reflect(UseCoinButton.prototype,"UseCoinButton",["eui.UIComponent","egret.DisplayObject"]);